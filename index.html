<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nuolaidos ir Pasiūlymai</title>
  <link rel="stylesheet" href="style.css">
  <!-- PDF.js via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  </script>

  
</head>
<body>

  <h1>Nuolaidos ir pasiūlymai BLS darbuotojams</h1>

  <!-- GRIDAS-->
  <div id="grid" class="grid"></div>


  <!-- DAUGIAPUSLAPIAI PDF-->
  <div id="carouselContainer"></div>

  
 

  <!-- Fullscreen PDF viewer (canvas + arrows + Close) -->
  <div id="overlay" class="overlay">
    <div class="overlay-box">
      <button class="close-btn" id="closeBtn">Close</button>
      <div class="nav-arrow nav-arrow-left" id="prevPageBtn">&#10094;</div>
      <div class="nav-arrow nav-arrow-right" id="nextPageBtn">&#10095;</div>
      <canvas id="pdfCanvas"></canvas>
    </div>
  </div>

  <script>
    /* ========= FILE LISTS ========= */
     /*nurodyti failų pavadinimus */

    // Multi-page PDFs -> each gets its own carousel block
    const multiPagePdfs = [
      "PDF`s/Antėja iki 2026 01 31.pdf",
      "PDF`s/GYM HUB pasiūlymas.pdf"
    ];

    // Single-page PDFs -> go into grid
    const singlePagePdfs = [
      "PDF`s/Bricks4Kidz pasiūlymas darbuotojams iki 2025-06-01 d..pdf",
      "PDF`s/CurioCity draugams – „Sanitex“, „UAB Baltic Logistic Solutions ir „Officeday darbuotojams taikomos išskirtinės nuolaidos.pdf",
      "PDF`s/Fielmann pasiūlymas iki 2025-12-31 d..pdf",
      "PDF`s/Girstučio komercinis pasiūlymas iki 2025.12.31.pdf",
      "PDF`s/Hopcover pasiūlymas darbuotojams.pdf",
      "PDF`s/Joglė pasiūlymas iki 2025-12-31.pdf",
      "PDF`s/Knygos.lt pasiūlymas iki 2025-12-31 d..pdf",
      "PDF`s/Makalius.lt pasiūlymas iki 2025-12-31 d..pdf",
      "PDF`s/Optometrijos centro pasiūlymas iki 2025-12-31 d..pdf",
      "PDF`s/Pro Bro +30 dienų nemokamai.pdf",
      "PDF`s/Pro Bro abonemento pasiūlymas iki 2025-03-31.pdf",
      "PDF`s/Šypsenos akademijos pasiūlymas iki 2025-12-31 d..pdf",
      "PDF`s/Švaros brolių pasiūlymas.pdf",
      "PDF`s/Vytautas Mineral SPA pasiūlymas iki 2025-12-20.pdf"
      

    ];

    const carouselContainer = document.getElementById("carouselContainer");
    const grid = document.getElementById("grid");
    const overlay = document.getElementById("overlay");
    const pdfCanvas = document.getElementById("pdfCanvas");
    const closeBtn = document.getElementById("closeBtn");
    const prevPageBtn = document.getElementById("prevPageBtn");
    const nextPageBtn = document.getElementById("nextPageBtn");

    // Fullscreen state
    let currentPdfDoc = null;
    let currentPdfPath = null;
    let currentPage = 1;
    let totalPages = 1;

    // Simple cache so we don't reload PDFs every time
    const pdfCache = new Map();

    async function getPdfDoc(pdfPath) {
      if (pdfCache.has(pdfPath)) {
        return pdfCache.get(pdfPath);
      }
      const loadingTask = pdfjsLib.getDocument(encodeURI(pdfPath));
      const pdf = await loadingTask.promise;
      pdfCache.set(pdfPath, pdf);
      return pdf;
    }

    /* ========= THUMBNAIL FOR A SPECIFIC PAGE ========= */
    async function generateThumbnailForPage(pdf, pageNumber) {
      const page = await pdf.getPage(pageNumber);
      const viewport = page.getViewport({ scale: 0.35 });
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({ canvasContext: ctx, viewport }).promise;

      return canvas.toDataURL();
    }

    /* ========= CARD CREATION ========= */
    async function createCard(pdfPath, pageNumber, labelText, isCarousel) {
      const card = document.createElement("div");
      card.className = isCarousel ? "carousel-item" : "grid-item";

      const thumb = document.createElement("div");
      thumb.className = "thumb";

      const img = document.createElement("img");
      const pdf = await getPdfDoc(pdfPath);
      img.src = await generateThumbnailForPage(pdf, pageNumber);

      thumb.appendChild(img);

      const title = document.createElement("div");
      title.className = "title";
      title.textContent = labelText;

      card.appendChild(thumb);
      card.appendChild(title);

      card.onclick = () => openPDF(pdfPath, pageNumber);

      return card;
    }

    /* ========= FULLSCREEN RENDER (FIT PAGE, HIGH QUALITY) ========= */
async function renderCurrentPage() {
  if (!currentPdfDoc) return;

  const page = await currentPdfDoc.getPage(currentPage);
  const canvas = pdfCanvas;
  const ctx = canvas.getContext("2d");

  const viewport1x = page.getViewport({ scale: 1 });

  // Screen dimensions (fit 95% of window)
  const screenW = window.innerWidth * 0.95;
  const screenH = window.innerHeight * 0.95;

  // Base scale to fit page into screen
  const fitScale = Math.min(
    screenW / viewport1x.width,
    screenH / viewport1x.height
  );

  // Get device pixel ratio for high-DPI screens
  const dpr = window.devicePixelRatio || 1;

  // Oversample for high quality (adaptive with DPR)
  const oversample = 2; // can increase to 3 or 4 if performance allows
  const renderScale = fitScale * oversample * dpr;

  const renderViewport = page.getViewport({ scale: renderScale });

  // Set canvas internal size (actual pixels)
  canvas.width = renderViewport.width;
  canvas.height = renderViewport.height;

  // Set canvas CSS size (what user sees)
  canvas.style.width = `${viewport1x.width * fitScale}px`;
  canvas.style.height = `${viewport1x.height * fitScale}px`;

  // Enable high-quality rendering
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';

  await page.render({
    canvasContext: ctx,
    viewport: renderViewport
  }).promise;

  updateNavButtons();
}




    function updateNavButtons() {
      if (totalPages <= 1) {
        prevPageBtn.style.display = "none";
        nextPageBtn.style.display = "none";
        return;
      }
      prevPageBtn.style.display = currentPage > 1 ? "flex" : "none";
      nextPageBtn.style.display = currentPage < totalPages ? "flex" : "none";
    }

    async function openPDF(pdfPath, pageNumber) {
      overlay.style.display = "flex";
      requestAnimationFrame(() => overlay.classList.add("active"));

      currentPdfPath = pdfPath;
      currentPdfDoc = await getPdfDoc(pdfPath);
      totalPages = currentPdfDoc.numPages || 1;
      currentPage = pageNumber || 1;

      await renderCurrentPage();
    }

    /* ========= RENDER CAROUSEL BLOCKS FOR MULTI-PAGE PDFs ========= */
    (async () => {
      for (const pdfPath of multiPagePdfs) {
        const pdf = await getPdfDoc(pdfPath);
        const numPages = pdf.numPages || 1;

        // Create block
        const block = document.createElement("div");
        const titleDiv = document.createElement("div");
        titleDiv.className = "pdf-block-title";
        titleDiv.textContent = pdfPath.split("/").pop();
        const wrapper = document.createElement("div");
        wrapper.className = "carousel-wrapper";

        block.appendChild(titleDiv);
        block.appendChild(wrapper);
        carouselContainer.appendChild(block);

        // Add each page as separate thumbnail
        for (let p = 1; p <= numPages; p++) {
          const label = `Puslapis ${p} / ${numPages}`;
          const card = await createCard(pdfPath, p, label, true);
          wrapper.appendChild(card);
        }
      }
    })();

    /* ========= RENDER GRID FOR SINGLE-PAGE PDFs ========= */
    (async () => {
      for (const pdfPath of singlePagePdfs) {
        // Label: just filename
        const card = await createCard(pdfPath, 1, pdfPath.split("/").pop(), false);
        grid.appendChild(card);
      }
    })();

    /* ========= FULLSCREEN CONTROLS ========= */
    closeBtn.onclick = () => {
      overlay.classList.remove("active");
      setTimeout(() => {
        overlay.style.display = "none";
        const ctx = pdfCanvas.getContext("2d");
        ctx.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
      }, 350);
    };

    overlay.onclick = (e) => {
      if (e.target === overlay) closeBtn.onclick();
    };

    prevPageBtn.onclick = async (e) => {
      e.stopPropagation();
      if (!currentPdfDoc || currentPage <= 1) return;
      currentPage--;
      await renderCurrentPage();
    };

    nextPageBtn.onclick = async (e) => {
      e.stopPropagation();
      if (!currentPdfDoc || currentPage >= totalPages) return;
      currentPage++;
      await renderCurrentPage();
    };
  </script>
</body>
</html>
